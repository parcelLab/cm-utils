{"version":3,"names":["HTTPError","Error","CmBanner","constructor","hostRef","this","fetchBanner","catch","console","warn","getTrackingPropsFromURL","search","URLSearchParams","window","location","xid","get","trackingId","trackingNo","courier","orderNo","userId","async","fetchJSON","toString","urlProps","trackingInfos","fetchTrackingInfos","_b","_a","header","id","_d","_c","url","opts","response","fetch","ok","statusText","json","discoverTrackingId","query","Object","assign","language","medium","result","apiURL","_campaign","values","contentType","bannerType","banner","_f","_e","targetUrl","bannerSrc","_g","bannerImage","render","h","href","target","src","style","maxWidth","undefined"],"sources":["./src/components/cm-banner/cm-banner.tsx"],"sourcesContent":["import { Component, h, Prop, State } from \"@stencil/core\";\n\nclass HTTPError extends Error {}\n\ntype Campaign = {\n\tcampaignId: string;\n\topenTrackingUrl: string;\n\tanalyticsBaseUrl: string;\n\tvalues: {\n\t\t[contentType: string]: {\n\t\t\t[bannerType: string]: {\n\t\t\t\ttargetUrl: string;\n\t\t\t\tbannerImage: {\n\t\t\t\t\turl: string;\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t};\n};\n\ntype TrackingInfo = {\n\theader: { id: string; [key: string]: string }[];\n\tbody: {\n\t\t[key: string]: string;\n\t};\n};\n\n@Component({\n\ttag: \"pl-cm-banner\",\n\tshadow: false,\n})\nexport class CmBanner {\n\t@Prop() apiURL: string =\n\t\t\"https://business-api.parcellab.com/v3/public/campaign/contentBlocks\";\n\t@Prop() medium: string = \"web\";\n\t@Prop() contentType: string = \"banner_order_status_page\";\n\t@Prop() bannerType: string = \"mainBannerVertical\";\n\t@Prop() language: string;\n\t@Prop({ mutable: true }) trackingId: string;\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\t@State() _campaign: Campaign;\n\t@State() bannerSrc: string;\n\t@State() targetUrl: string;\n\n\tconstructor() {\n\t\tthis.fetchBanner().catch(console.warn);\n\t}\n\n\tgetTrackingPropsFromURL() {\n\t\tconst search = new URLSearchParams(window.location.search);\n\t\tconst xid = search.get(\"xid\");\n\t\tconst trackingId = search.get(\"tid\");\n\t\tconst trackingNo = search.get(\"trackingNo\") || search.get(\"tno\");\n\t\tconst courier = search.get(\"courier\") || search.get(\"c\");\n\t\tconst orderNo = search.get(\"orderNo\");\n\t\tconst userId =\n\t\t\tsearch.get(\"plUserId\") || search.get(\"u\") || search.get(\"userId\");\n\n\t\treturn {\n\t\t\txid,\n\t\t\ttrackingId,\n\t\t\ttrackingNo,\n\t\t\tcourier,\n\t\t\torderNo,\n\t\t\tuserId,\n\t\t};\n\t}\n\n\tasync fetchTrackingInfos(search: URLSearchParams): Promise<TrackingInfo> {\n\t\treturn this.fetchJSON<TrackingInfo>(\n\t\t\t`https://api.parcellab.com/v2/checkpoints?${new URLSearchParams(\n\t\t\t\tsearch\n\t\t\t).toString()}`\n\t\t);\n\t}\n\n\tasync discoverTrackingId() {\n\t\tif (!this.trackingId) {\n\t\t\tconst urlProps = this.getTrackingPropsFromURL();\n\t\t\tif (urlProps.trackingId) return urlProps.trackingId;\n\n\t\t\tif (\n\t\t\t\t(urlProps.trackingNo && urlProps.courier) ||\n\t\t\t\t(urlProps.orderNo && urlProps.userId) ||\n\t\t\t\t(urlProps.xid && urlProps.userId)\n\t\t\t) {\n\t\t\t\tconst trackingInfos = await this.fetchTrackingInfos(\n\t\t\t\t\tnew URLSearchParams(urlProps)\n\t\t\t\t);\n\t\t\t\tif (trackingInfos?.header?.[0]?.id)\n\t\t\t\t\tthis.trackingId = trackingInfos?.header?.[0]?.id;\n\t\t\t}\n\t\t}\n\t}\n\n\tasync fetchJSON<T>(url: RequestInfo, opts?: RequestInit): Promise<T> {\n\t\tconst response = await fetch(url, opts);\n\n\t\tif (!response.ok) {\n\t\t\tthrow new HTTPError(`Fetch error: ${response.statusText}`);\n\t\t}\n\n\t\tconst json = await response.json() as T;\n\t\treturn json;\n\t}\n\n\tasync fetchBanner() {\n\t\tawait this.discoverTrackingId();\n\t\tif (this.trackingId) {\n\t\t\tconst query = {\n\t\t\t\t...(this.language && { language: this.language }),\n\t\t\t\t...(this.medium && { medium: this.medium }),\n\t\t\t\ttrackingId: this.trackingId,\n\t\t\t};\n\t\t\tconst search = new URLSearchParams({\n\t\t\t\t...query,\n\t\t\t});\n\t\t\tconst result = await this.fetchJSON<Campaign>(\n\t\t\t\t`${this.apiURL}?${search.toString()}`\n\t\t\t);\n\t\t\tthis._campaign = result;\n\t\t\tif (this._campaign?.values?.[this.contentType]?.[this.bannerType]) {\n\t\t\t\tconst banner =\n\t\t\t\t\tthis._campaign?.values?.[this.contentType]?.[\n\t\t\t\t\t\tthis.bannerType\n\t\t\t\t\t];\n\t\t\t\tthis.targetUrl = banner.targetUrl || \"\";\n\t\t\t\tthis.bannerSrc = banner.bannerImage?.url || \"\";\n\t\t\t}\n\t\t}\n\t}\n\n\trender() {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\t\treturn this.bannerSrc && this.targetUrl ? (\n\t\t\t\t<a href={this.targetUrl} target=\"_blank\">\n\t\t\t\t\t<img src={this.bannerSrc} style={{ maxWidth: \"100%\" }} />\n\t\t\t\t</a>\n\t\t\t) : undefined;\n\t}\n}\n"],"mappings":"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"}