{"file":"pl-cm-banner.entry.esm.js","mappings":"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","names":[],"sources":["./src/components/cm-banner/cm-banner.tsx"],"sourcesContent":["import { Component, h, Prop, State } from \"@stencil/core\";\n\nclass HTTPError extends Error {}\n\ntype Campaign = {\n\tcampaignId: string;\n\topenTrackingUrl: string;\n\tanalyticsBaseUrl: string;\n\tvalues: {\n\t\t[contentType: string]: {\n\t\t\t[bannerType: string]: {\n\t\t\t\ttargetUrl: string;\n\t\t\t\tbannerImage: {\n\t\t\t\t\turl: string;\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t};\n};\n\ntype TrackingInfo = {\n\theader: { id: string; [key: string]: string }[];\n\tbody: {\n\t\t[key: string]: string;\n\t};\n};\n\n@Component({\n\ttag: \"pl-cm-banner\",\n\tshadow: false,\n})\nexport class CmBanner {\n\t@Prop() apiURL: string =\n\t\t\"https://business-api.parcellab.com/v3/public/campaign/contentBlocks\";\n\t@Prop() medium: string = \"web\";\n\t@Prop() contentType: string = \"banner_order_status_page\";\n\t@Prop() bannerType: string = \"mainBannerVertical\";\n\t@Prop() language: string;\n\t@Prop({ mutable: true }) trackingId: string;\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\t@State() _campaign: Campaign;\n\t@State() bannerSrc: string;\n\t@State() targetUrl: string;\n\n\tconstructor() {\n\t\tthis.fetchBanner().catch(console.warn);\n\t}\n\n\tgetTrackingPropsFromURL() {\n\t\tconst search = new URLSearchParams(window.location.search);\n\t\tconst xid = search.get(\"xid\");\n\t\tconst trackingId = search.get(\"tid\");\n\t\tconst trackingNo = search.get(\"trackingNo\") || search.get(\"tno\");\n\t\tconst courier = search.get(\"courier\") || search.get(\"c\");\n\t\tconst orderNo = search.get(\"orderNo\");\n\t\tconst userId =\n\t\t\tsearch.get(\"plUserId\") || search.get(\"u\") || search.get(\"userId\");\n\n\t\treturn {\n\t\t\txid,\n\t\t\ttrackingId,\n\t\t\ttrackingNo,\n\t\t\tcourier,\n\t\t\torderNo,\n\t\t\tuserId,\n\t\t};\n\t}\n\n\tasync fetchTrackingInfos(search: URLSearchParams): Promise<TrackingInfo> {\n\t\treturn this.fetchJSON<TrackingInfo>(\n\t\t\t`https://api.parcellab.com/v2/checkpoints?${new URLSearchParams(\n\t\t\t\tsearch\n\t\t\t).toString()}`\n\t\t);\n\t}\n\n\tasync discoverTrackingId() {\n\t\tif (!this.trackingId) {\n\t\t\tconst urlProps = this.getTrackingPropsFromURL();\n\t\t\tif (urlProps.trackingId) return urlProps.trackingId;\n\n\t\t\tif (\n\t\t\t\t(urlProps.trackingNo && urlProps.courier) ||\n\t\t\t\t(urlProps.orderNo && urlProps.userId) ||\n\t\t\t\t(urlProps.xid && urlProps.userId)\n\t\t\t) {\n\t\t\t\tconst trackingInfos = await this.fetchTrackingInfos(\n\t\t\t\t\tnew URLSearchParams(urlProps)\n\t\t\t\t);\n\t\t\t\tif (trackingInfos?.header?.[0]?.id)\n\t\t\t\t\tthis.trackingId = trackingInfos?.header?.[0]?.id;\n\t\t\t}\n\t\t}\n\t}\n\n\tasync fetchJSON<T>(url: RequestInfo, opts?: RequestInit): Promise<T> {\n\t\tconst response = await fetch(url, opts);\n\n\t\tif (!response.ok) {\n\t\t\tthrow new HTTPError(`Fetch error: ${response.statusText}`);\n\t\t}\n\n\t\tconst json = (await response.json()) as T;\n\t\treturn json;\n\t}\n\n\tasync fetchBanner() {\n\t\tawait this.discoverTrackingId();\n\t\tif (this.trackingId) {\n\t\t\tconst query = {\n\t\t\t\t...(this.language && { language: this.language }),\n\t\t\t\t...(this.medium && { medium: this.medium }),\n\t\t\t\ttrackingId: this.trackingId,\n\t\t\t};\n\t\t\tconst search = new URLSearchParams({\n\t\t\t\t...query,\n\t\t\t});\n\t\t\tconst result = await this.fetchJSON<Campaign>(\n\t\t\t\t`${this.apiURL}?${search.toString()}`\n\t\t\t);\n\t\t\tthis._campaign = result;\n\t\t\tif (this._campaign?.values?.[this.contentType]?.[this.bannerType]) {\n\t\t\t\tconst banner =\n\t\t\t\t\tthis._campaign?.values?.[this.contentType]?.[\n\t\t\t\t\t\tthis.bannerType\n\t\t\t\t\t];\n\t\t\t\tthis.targetUrl = banner.targetUrl || \"\";\n\t\t\t\tthis.bannerSrc = banner.bannerImage?.url || \"\";\n\t\t\t}\n\t\t}\n\t}\n\n\trender() {\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-return\n\t\treturn this.bannerSrc && this.targetUrl ? (\n\t\t\t<a href={this.targetUrl} target=\"_blank\">\n\t\t\t\t<img src={this.bannerSrc} style={{ maxWidth: \"100%\" }} />\n\t\t\t</a>\n\t\t) : undefined;\n\t}\n}\n"],"version":3}